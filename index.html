<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>execCommand test</title>
<style>
    body{
        width: 100%;
        text-align: center;
    }
    #toolbar{
        width: 1000px;
        height: 30px;
        border: 1px solid gray;
        margin: auto;
        text-align: left;
        padding: 5px;
   
       
    }
    iframe{
        width: 1000px;
        height: 600px;
        padding:0px 5px;
        border-bottom: 1px solid gray;
        border-right: 1px solid gray;
        border-left: 1px solid gray;
      
    }
    .text-color{
      width: 250px;
      height: 250px;
      position: relative;

    }
    #color-popup{
        width: 250px;
        height: 300px;
        left: 0px;
        top:0px;
        z-index: 1;
        background: #eee;
        position: absolute;
        visibility: hidden;
        display: flex;
        flex-direction: column;
    }
   
   
    .text-color-view{

        /* position: absolute; */
        /* bottom:0px; */
        margin: 13px;
        width: 227px;
        height: 200px;
        z-index: 1;
    }
    .color-result{
        margin: 3px;
        height: 20px;
        float: left;
    }
    .cancel{
        margin: 3px;
        float: right;
    }
    .color-search{
        margin-top:3px;
        height: 25px;
    }
   
    #font_family{
       float: left;
       margin: 0px 3px;
    }
    .select{
        height: 30px;
    }
    #color-view{
        margin-top: 5px;
        background: #000;
    }
    .color , .color-view{
        width: 20px;
        height: 20px;
        border: 0.5px solid gray;
    
    }
    .span-color-view{
        text-align: center;
    }
    #backgorund-color-popup{
        width: 270px;
        height: 100px;
        left: 0px;
        top:0px;
        z-index: 1;
        background: #eee;
        position: absolute;
        visibility: hidden;
        display: flex;
        flex-direction: column;
    }
    #background-color-view{
        width: 260px;
        height: 44px;
        margin: 10px 3px;
        text-align: center;
    }
    .background-color{
        width: 22px;
        height: 22px;
    }
    img:checked{
        background-color: #000;
    }
    #link{
        width: 250px;
        height: 30px;
        position: relative;
       
    }
    #link_popup{
        width: 250px;
        height: 30px;
        left: 0px;
        top:0px;
        margin: auto;
        text-align: center;
        z-index: 1;
        background: #eee;
        position: absolute;
        visibility: hidden;
      
    }
    #link_btn{
        margin-top: 3px;
    }
</style>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    let xE = {};

 

   
    function xFn(e)
    {
        
        xE.frame.focus();
      
    
        xE.draw.queryCommandSupported(e);
        let color_popup=document.getElementById("color-popup");
        let back_color_popup=document.getElementById("backgorund-color-popup");
        let link_popup=document.getElementById("link_popup");
                   
        if(e==="foreColor"){
            color_popup.style.visibility="visible";
            back_color_popup.style.visibility="hidden";
            link_popup.style.visibility="hidden";
        }else if(e==="backColor"){
           back_color_popup.style.visibility="visible";
           color_popup.style.visibility="hidden";
           link_popup.style.visibility="hidden";
        }else if(e==="createLink"){
            link_popup.style.visibility="visible";
            back_color_popup.style.visibility="hidden";
           color_popup.style.visibility="hidden";
           document.getElementById("link_input").focus();
   
        }else{
            xE.draw.execCommand(e, false); 
        }
       
   
       
        // e = e.nextSibling;
        // e = e.nodeName.toLowerCase() == 'input' ? e.value : null;
   
        // view += '<br>queryCommandEnabled : ';
        // try { view += xE.draw.queryCommandEnabled(content); } catch (x) { view += 'Error : ' + x.message; }
        // view += '<br>queryCommandState : ';
        // try { view += xE.draw.queryCommandState(content); } catch (x) { view += 'Error : ' + x.message; }
        // view += '<br>queryCommandValue : ';
        // try { view += xE.draw.queryCommandValue(content); } catch (x) { view += 'Error : ' + x.message; }
        // view += '<br>execCommand : ';
       
        // xE.m.innerHTML = view;
     
      
      
    }

    function xHv()
    {
        xE.m.innerHTML =
            xE.draw.body.innerHTML
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
    }

    window.onload = function()
    {
        xE.frame = document.getElementById('yF').contentWindow;
        xE.draw = xE.frame.document;

        xE.draw.write('<!DOCTYPE html><html><head></head><body></body></html>');
        xE.draw.designMode = 'on';

        // xE.m = document.getElementById('yM');

        xE.frame.focus();
    }
</script>
</head>
<body>
<div id="toolbar">
    <!-- <img src="public/font-family.png" alt="fontName" onclick="xFn(this.alt)"></img><input id="aa" type=text size=8> -->
    <select name="font_family" id="font_family" class="select">
        <option value="돋움" style="font-family:'돋움';">돋움</option>
        <option value="바탕" style="font-family:'바탕';" >바탕</option>
        <option value="궁서" style="font-family:'궁서';">궁서</option>
        <option value="굴림" style="font-family:'굴림';">굴림</option>
        <option value="신명조" style="font-family:'신명조';">신명조</option>
    </select>
    <select name="font_size" id="font_size" class="select">
            <option value="2" style="font-size:10px;">13px</option>
            <option value="3" style="font-size:12px;" selected>16px</option>
            <option value="4" style="font-size:14px;">18px</option>
            <option value="5" style="font-size:18px;">24px</option>
            <option value="6" style="font-size:24px;">32px</option>
            <option value="7" style="font-size:36px;">48px</option>
                
    </select>
    <img src="public/italic.png" alt="italic" onclick="xFn(this.alt)"></img>
    <img src="public/bold.png" alt="bold" onclick="xFn(this.alt)"></img>
    <sapn class="text-color">
        <img src="public/text-color.png" alt="foreColor" onclick="xFn(this.alt)"></img>
        <span id="color-popup">
            <span class="color-setting">
                <input type=text size=8 id="tcolor-result" class="color-result" placeholder="ex)FFFFFF">
                <button  class="color-search" onclick="color_search()" >검색</button>
                <button class="cancel" onclick="cancel()">X</button>
            </span>
            <sapn class="span-color-view">
                색상 : <button class="color-view" id="tcolor_view"></button>
            </sapn>
            <span class="text-color-view">
                   <button class="color" onclick="color(this)" style="background-color:#787878;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF8C8C;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFC846;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FAFAA0;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#4AB34A;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#00F2F2;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#333380 ;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#9048d4;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#fff;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#6e6e6e;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF8282;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFC341;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FAFA96;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#40A940;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#00EDED;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#282880;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#8f31ea;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#eee;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#646464;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF7878;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFBE3C;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FAF58C;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#369F36;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#00D5F2;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#002e80;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#8b00ff;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#ddd;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#5a5a5a;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF6E6E;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFB937;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FAF082;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#2C952C;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#00C1F2;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#001e80;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#a22bff;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#dcdcdc;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#505050;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF6464;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFB432;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FAEB78;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#228B22;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#00AFF4 ;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#000f80;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#9b21ff;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#d2d2d2;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#464646;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF5A5A;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFB900;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFEB46;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#288C28;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#0094F7 ;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#1e1e80;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#9314ff;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#c8c8c8;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#3c3c3c;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF5050;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFAF00;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFE641;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#1E821E;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#007BF7;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#141480;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#8b00ff;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#bebebe;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#323232;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF4646;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFA500;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFE13C;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#147814;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#005AF7;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#0a0a80;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#8300f8;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#b4b4b4;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#282828;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF3232;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF9B00;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFDC37;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#0A6E0A;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#0020F7;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#000080;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#7b00f0;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#aaaaaa;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#000;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF0000;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FF9100;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#FFD732;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#006400;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#0004F9;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#0f0080;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#7300e9;"></button>
                   <button class="color" onclick="color(this)" style="background-color:#a0a0a0 ;"></button>
            </span>
        </span>
    </sapn>
    <span class="text-color">
        <img id="background-color" src="public/bakground.png" alt="backColor" onclick="xFn(this.alt)"></img>
            <span id="backgorund-color-popup">    
                <span class="color-setting">
                    <input type=text size=8 id="bcolor-result" class="color-result" placeholder="ex)FFFFFF">
                    <button class="color-search" onclick="back_color_search()" >검색</button>
                    <button class="cancel" onclick="cancel()">X</button>
                </span>
                <sapn class="span-color-view">
                    색상 : <button class="color-view"  id="bcolor_view"></button>
                </sapn>
                <span id="background-color-view">
                    <button class="background-color" onclick="background_color(this)" style="background-color:#FFF;"></button>
                    <button class="background-color" onclick="background_color(this)" style="background-color:#F00;"></button>
                    <button class="background-color" onclick="background_color(this)" style="background-color:#FF7F00;"></button>
                    <button class="background-color" onclick="background_color(this)" style="background-color:#FF0;"></button>
                    <button class="background-color" onclick="background_color(this)" style="background-color:#008000;"></button>
                    <button class="background-color" onclick="background_color(this)" style="background-color:#00F;"></button>
                    <button class="background-color" onclick="background_color(this)" style="background-color:#000080 ;"></button>
                    <button class="background-color" onclick="background_color(this)" style="background-color:#4B0082;"></button>
                    <button class="background-color" onclick="background_color(this)" style="background-color:#000;"></button>
                </span>
            </span>
    </span>
    <img src="public/left-alignment.png" alt="justifyLeft" onclick="xFn(this.alt)"></img>
    <img src="public/center-alignment.png" alt="justifyCenter" onclick="xFn(this.alt)"></img>
    <img src="public/right-alignment.png" alt="justifyRight" onclick="xFn(this.alt)"></img>
    <span id="link"> 
        <img src="public/link.png" alt="createLink" onclick="xFn(this.alt)"></img>
        <span id="link_popup">
            <span id="link_input_view">
                <input type=text size=16 id="link_input">
                <button id="link_btn" onclick="link()">적용</button>
            </span>
        </span>
    </span>
    <input multiple="multiple"  type="file" name="filename[]" onchange='openFile(event)' />
    <!-- <img src="public/image.png" alt="insertImage" onclick="xFn(this.alt)"></img><input type=text size=16> -->
    <!-- <img type=img onclick="xHv()">HTML</img> -->
</div>
<iframe id="yF" src="about:blank"></iframe>
<script>
    let if_mo;
    document.getElementById('yF').addEventListener('mouseover',function(){
        if_mo=true;
    });
    window.addEventListener('blur',function(){
        if(if_mo){
            link_popup.style.visibility="hidden";
            if_mo=false;
        }
    });
   
    $('#font_family').change(function() {
            const font_family = $(this).val();
            xE.draw.execCommand("fontName", false, font_family); 
    });
    $('#font_size').change(function() {
            const font_size = $(this).val();
            xE.draw.execCommand("fontSize", false, font_size); 
          
    });

 
    function color_search(){
        const tcolor_result=$("#tcolor-result").val();
        $("#tcolor_view").css("background-color","#"+tcolor_result);
        xE.draw.execCommand("foreColor", false, tcolor_result); 
    }
    function color(e){
        let color = $(e).css( "background-color" );
        $("#tcolor_view").css("background-color",color);
        xE.draw.execCommand("foreColor", false,color); 
    }    
    function back_color_search(){
        const bcolor_result=$("#bcolor-result").val();
        $("#bcolor_view").css("background-color","#"+bcolor_result);
        xE.draw.execCommand("backColor", false, bcolor_result); 
    }   
    function background_color(e){
        let background = $(e).css( "background-color" );
        $("#bcolor_view").css("background-color",background);
        xE.draw.execCommand("backColor", false,background); 
    }
    function cancel(){
        const color_popup=document.getElementById("color-popup");
        const back_color_popup=document.getElementById("backgorund-color-popup");
        color_popup.style.visibility="hidden";
        back_color_popup.style.visibility="hidden";
    }
    function link(){
        const link_input=document.getElementById("link_input").value;
        link_popup.style.visibility="hidden";
        xE.draw.execCommand("createLink", false,link_input); 
    }

    	
    var openFile = function(event) {
            const input = event.target;
			var reader = new FileReader();
			alert(reader.result);

            reader.onload = function(){
                alert("a");
                // xE.draw.execCommand("insertImage", false,reader.result); 
					// var _mockdata = {
					// 	'imageurl':,
					// 	'filename': input.files[i].name,
					// 	'filesize': input.files[i].size,
					// 	'imagealign': 'C',
					// 	'originalurl': reader.result,
					// 	'thumburl':reader.result
					// };
				
				
			};
    
          };
				
</script>
</body>
</html>